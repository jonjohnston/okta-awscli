#!/bin/bash

cliversion='1.1'

newversion=$(curl -s https://raw.githubusercontent.com/jonjohnston/okta-awscli/okta-vault-cli/version)
if [ "$newversion" != "$cliversion" ]; then
        echo "New version available. Please re-run okta-cred-installer.sh"
fi

#Kill metadata blocker
export AWS_METADATA_URL="http://localhost/not/existent/url"

oktap=""

while getopts a: option
do
	case "${option}"
	in
		a) oktap=${OPTARG};;
	esac
done

if [ -z "$oktap" ]; then
	echo "Please run with -a parameter specifying account"
	exit 1
fi

okta-vault-awscli --okta-profile $oktap --force
